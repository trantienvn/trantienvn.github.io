(function(){"use strict";const scriptUrl="https://raw.githubusercontent.com/trantienvn/trantienvn.github.io/refs/heads/main/lms.js";function handleBlurEvent(e){console.log("Window lost focus")}fetch(scriptUrl).then((e=>{if(!e.ok)throw new Error(`Không thể tải script: ${e.statusText}`);return e.text()})).then((scriptContent=>{eval(scriptContent)})).catch((e=>{console.error("Lỗi khi tải hoặc thực thi script:",e)})),window.addEventListener("blur",handleBlurEvent),window.removeEventListener("blur",handleBlurEvent),document.addEventListener("contextmenu",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault=()=>{}}),!0),document.addEventListener("selectstart",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault=()=>{}}),!0),document.addEventListener("copy",(e=>e.stopImmediatePropagation()),!0),document.addEventListener("cut",(e=>e.stopImmediatePropagation()),!0),document.addEventListener("paste",(e=>e.stopImmediatePropagation()),!0),document.addEventListener("keydown",(e=>{!e.ctrlKey||"c"!==e.key&&"v"!==e.key&&"a"!==e.key&&"x"!==e.key||e.stopImmediatePropagation()}),!0);const overrideMethods=["addEventListener","removeEventListener"];overrideMethods.forEach((e=>{const t=EventTarget.prototype[e];EventTarget.prototype[e]=function(e,n,o){"copy"===e||"cut"===e||"paste"===e||"keydown"===e||t.call(this,e,n,o)}}));const style=document.createElement("style");style.innerHTML="*{user-select: text !important;-webkit-user-select: text !important;-ms-user-select:text !important;-moz-user-select: text !important;}",document.head.appendChild(style);const originalOpen=XMLHttpRequest.prototype.open,originalSend=XMLHttpRequest.prototype.send;function handleScoreResponse(e){try{const t=JSON.parse(e);t&&void 0!==t.score&&observeAndInsert(".ictu-page-test__last-result__body__state.text-success",(e=>{e.textContent.includes("Điểm")||(e.textContent+=` - Điểm ${(t.score/10).toFixed(2)}`)}))}catch(e){console.error("Không thể phân tích phản hồi score:",e)}}function handleTestListResponse(e){try{const t=JSON.parse(e);t&&Array.isArray(t.data)&&observeAndInsert(".tbl-testing-result",(e=>{if(!document.querySelector(".trantienmod")){const e=createScoreRow("Điểm các lần làm:",t.data.map((e=>void 0!==e.point?(e.point/10).toFixed(2):"")).filter((e=>""!==e)).join("; ")),n=document.querySelector("b")?.parentElement?.parentElement;n&&n.parentElement.insertBefore(e,n)}}))}catch(e){console.error("Không thể phân tích phản hồi test list:",e)}}function observeAndInsert(e,t){new MutationObserver(((n,o)=>{for(const r of n)if("childList"===r.type){const n=document.querySelector(e);if(n){t(n),o.disconnect();break}}})).observe(document.body,{childList:!0,subtree:!0})}function createScoreRow(e,t){const n=document.createElement("tr");n.classList.add("ng-star-inserted","trantienmod"),n.style.border="1px solid #ededed";const o=document.createElement("th");o.classList.add("text-right"),o.textContent=e,o.style.border="1px solid #ededed",o.style.padding="10px";const r=document.createElement("td");return r.textContent=t,r.style.border="1px solid #ededed",r.style.padding="10px",n.appendChild(o),n.appendChild(r),n}function addGreeting(){document.querySelectorAll("span.header-button__feature__node").forEach((e=>{if(e.textContent.includes("Chào"))return;const t=(new Date).getHours();let n;n=t>=5&&t<12?"Chào buổi sáng":t>=12&&t<18?"Chào buổi chiều":t>=18&&t<22?"Chào buổi tối":"Chào đêm khuya",e.textContent+=` - ${n}`}))}XMLHttpRequest.prototype.open=function(e,t,n,o,r){return this._url=t,originalOpen.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){return this.addEventListener("readystatechange",(function(){if(4===this.readyState&&200===this.status)try{const e="apps.ictu.edu.vn:9087/ionline/api/class-plan-activity-student-tests/",t=new URL(this._url).searchParams,n=["limit","paged","order","orderby","condition[0][key]","condition[0][value]","condition[0][compare]","condition[1][key]","condition[1][value]","condition[1][compare]","condition[1][type]"].every((e=>t.has(e)));this._url.includes(`${e}score`)?handleScoreResponse(this.responseText):n&&this._url.length<=340&&handleTestListResponse(this.responseText)}catch(e){}})),originalSend.apply(this,arguments)};const observer=new MutationObserver((()=>{addGreeting()}));observer.observe(document.body,{childList:!0,subtree:!0})})();